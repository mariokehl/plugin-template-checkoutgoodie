function CheckoutGoodie(e){this.itemSum=e,this.getConfig=function(){return JSON.parse(document.getElementById("checkout-goodie-config").textContent)},this.getGrossValue=function(){return this.getConfig().grossValue},this.getItemSum=function(){if("number"==typeof this.itemSum)return this.itemSum;return this.getConfig().initialData.amount},this.getGoalReachedMessage=function(){return this.getConfig().messages.goal},this.getNextGoal=function(){const e=this.getConfig();return 0===e.tierList.length?this.getGrossValue():e.tierList[0]&&this.getItemSum()<e.tierList[0]?e.tierList[0]:e.tierList[1]&&this.getItemSum()<e.tierList[1]?e.tierList[1]:this.getGrossValue()},this.getMissingMessage=function(e,t){const i=this.getConfig();let n=t?i.messages.interim:i.messages.missing;return n=n.replace(":amount",Intl.NumberFormat("de-DE",{maximumFractionDigits:2,minimumFractionDigits:2}).format(e)),n=n.replace(":currency",i.currency),n},this.getPercentage=function(){let e=this.getItemSum()/this.getGrossValue()*100;return e=Math.floor(e),e=e>100?100:e,e},this.calc=function(){let e;const t=this.getNextGoal()-this.getItemSum();e=t<=0?this.getGoalReachedMessage():this.getNextGoal()!==this.getGrossValue()?this.getMissingMessage(t,!0):this.getMissingMessage(t);const i=this.getPercentage(),n=document.querySelectorAll('[role="progressbar"]')[0];return n.setAttribute("aria-valuenow",i),n.style.width=i+"%",e},this.init=function(){let e=this.getConfig();this.itemSum&&(e.initialData.amount=this.itemSum,e.initialData.percentage=this.getPercentage(),document.getElementById("checkout-goodie-config").textContent=JSON.stringify(e))},this.setLabel=function(){const e=document.getElementsByClassName("missing-goodie-amount");if(e.length){const t=this;Array.prototype.forEach.call(e,(function(e){e.innerHTML=t.calc()}))}else this.init()}}function waitForElement(e){return new Promise((t=>{if(document.querySelector(e))return t(document.querySelector(e));const i=new MutationObserver((n=>{document.querySelector(e)&&(t(document.querySelector(e)),i.disconnect())}));i.observe(document.body,{childList:!0,subtree:!0})}))}function toFloat(e){let t=e.indexOf(".");t<0&&(t=0);let i,n=e.indexOf(",");return n<0&&(n=0),i=t>n&&t?t:!!(n>t&&n)&&n,0==i?parseFloat(e.replace(/[^\d]/g,"")):parseFloat(e.substr(0,i).replace(/[^\d]/g,"")+"."+e.substr(i+1,e.length).replace(/[^0-9]/,""))}window.addEventListener("load",(()=>{new CheckoutGoodie(null).setLabel()}),!1),waitForElement(".basket-preview").then((()=>{new CheckoutGoodie(null).setLabel()})),document.addEventListener("afterBasketItemAdded",(e=>{new CheckoutGoodie(toFloat(document.querySelector(".toggle-basket-preview .badge").textContent)).setLabel()}),!1),document.addEventListener("afterBasketChanged",(e=>{const t=e.detail;new CheckoutGoodie(t.itemSum+("promotion"===t.couponCampaignType?t.couponDiscount:0)).setLabel()}),!1);