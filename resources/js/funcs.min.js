function CheckoutGoodie(e){this.itemSum=e,this.getConfig=function(){let e=JSON.parse(document.getElementById("checkout-goodie-config").textContent);return e},this.getGrossValue=function(){let e=this.getConfig();return e.grossValue},this.getItemSum=function(){if("number"==typeof this.itemSum)return this.itemSum;let e=this.getConfig();return e.initialData.amount},this.getGoalReachedMessage=function(){let e=this.getConfig();return e.messages.goal},this.getNextGoal=function(){let e=this.getConfig();return 0===e.thresholds.length?this.getGrossValue():e.thresholds[0]&&this.getItemSum()<e.thresholds[0]?e.thresholds[0]:e.thresholds[1]&&this.getItemSum()<e.thresholds[1]?e.thresholds[1]:this.getGrossValue()},this.getMissingMessage=function(e,t){let s=this.getConfig(),i=t?s.messages.interim:s.messages.missing;return(i=i.replace(":amount",Intl.NumberFormat("de-DE",{maximumFractionDigits:2,minimumFractionDigits:2}).format(e))).replace(":currency",s.currency)},this.getPercentage=function(){let e=this.getItemSum()/this.getGrossValue()*100;return(e=Math.floor(e))>100?100:e},this.calc=function(e){let t,s=this.getNextGoal()-this.getItemSum();t=s<=0?this.getGoalReachedMessage():this.getNextGoal()!==this.getGrossValue()?this.getMissingMessage(s,!0):this.getMissingMessage(s);let i=this.getPercentage(),n=document.querySelectorAll('[role="progressbar"]')[0];n.setAttribute("aria-valuenow",i),n.style.width=i+"%";let o=this.getConfig();return s<=0?(e.classList.remove(o.classes.missingAmount),e.classList.add(o.classes.reachedAmount),n.classList.remove(o.classes.missingAmount),n.classList.add(o.classes.reachedAmount)):(e.classList.remove(o.classes.reachedAmount),e.classList.add(o.classes.missingAmount),n.classList.remove(o.classes.reachedAmount),n.classList.add(o.classes.missingAmount)),t},this.init=function(){let e=this.getConfig();this.itemSum&&(e.initialData.amount=this.itemSum,e.initialData.percentage=this.getPercentage(),document.getElementById("checkout-goodie-config").textContent=JSON.stringify(e))},this.setLabel=function(){let e=document.getElementsByClassName("missing-goodie-amount");if(e.length){let t=this;Array.prototype.forEach.call(e,function(e){e.style.display="none",e.innerHTML=t.calc(e),e.style.display="block"})}else{this.init();return}},this.toggle=function(e){let t=this.getConfig(),s=t.excludedShippingCountries,i;i=s.includes(e)?"none":"block",Array.prototype.forEach.call(document.querySelectorAll(".checkout-goodie-container"),function(e){e.style.display=i})}}function waitForElement(e){return new Promise(t=>{if(document.querySelector(e))return t(document.querySelector(e));let s=new MutationObserver(i=>{document.querySelector(e)&&(t(document.querySelector(e)),s.disconnect())});s.observe(document.body,{childList:!0,subtree:!0})})}function toFloat(e){let t=e.indexOf(".");t<0&&(t=0);let s=e.indexOf(",");s<0&&(s=0);let i;return!1==(i=t>s&&t?t:s>t&&!!s&&s)?parseFloat(e.replace(/[^\d]/g,"")):parseFloat(e.substr(0,i).replace(/[^\d]/g,"")+"."+e.substr(i+1,e.length).replace(/[^0-9]/,""))}window.addEventListener("load",()=>{let e=new CheckoutGoodie(null);e.setLabel()},!1),waitForElement(".basket-preview").then(()=>{let e=new CheckoutGoodie(null);e.setLabel()}),document.addEventListener("afterBasketItemAdded",e=>{let t=document.querySelector(".toggle-basket-preview .badge").textContent,s=toFloat(t),i=new CheckoutGoodie(s);i.setLabel()},!1),document.addEventListener("afterBasketChanged",e=>{let t=e.detail,s=t.itemSum+("promotion"===t.couponCampaignType?t.couponDiscount:0),i=new CheckoutGoodie(s);i.setLabel()},!1),document.addEventListener("afterShippingCountryChanged",e=>{let t=e.detail,s=new CheckoutGoodie(null);s.toggle(t)});